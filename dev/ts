use NXCL::Package;
use NXCL::Environment;

my $env = NXCL::Environment->new;

my $fh = do {
  if (my $file = $ARGV[0]) {
    open my $fh, '<', $file or die "Couldn't open ${file}: $!";
    $fh;
  } else {
    \*STDIN;
  }
};

my $data = do { local $/; <$fh> };

while ($data =~ m/^(\$ (.*)\n)/mg) {
  my ($orig, $expr) = ($1, $2);
  my $rv = $env->eval_string($expr)->value_to_xcl_string;
  print $orig;
  say '= '.$rv->xcl_raw_value;
}
